
# MongoDB权威指南 -- 读书笔记

## 第三章 

### 修改器速度

- 在mongodb中进行修改操作的时候，如果只是进行数值的修改，例如用$inc,这种速度是非常快的，而使用数组修改器可能会改变文档大小，这样可能会导致文档位置发生变化，也就是说原来的位置已经容不下它了，比如如果依次插入的文档在磁盘上是相邻的，如果其中一个文档变大了，原来的位置就放不下它了，这个文档就会被移动到集合的另一个位置。

- 移动文档是非常慢的，MongoDB必须将文档原先所占的空间释放掉，然后将文档写入另一片空间。
- 通过实验表明如果一个是进行数值修改每秒可以达到13000次，而通过$push向文档插入数据，每秒小于1500次

- 如果你的模式在进行插入和删除时会进行大量的移动或者经常打乱数据，可以使用usePowerOf2Sizes选项以提高磁盘复用率，可以通过collMod命令来设定这个选项

```python

"""
> db.runCommand({"collMod": collectionName, "usePowerOf2Sizes": true})
"""
```
- 这个集合之后进行的所有空间分配，得到的块大小都是2的幂。由于这个选项会导致初始空间分配不再那么高效，所以应该只在需要经常打乱数据的集合上使用，如果这个命令中指定"usePowerOf2Sizes"选项的值为false,就会关闭这种特殊分配机制。这个选项只会影响之后新分配的记录，因此，在已有的集合上运行这个命令或者是更改这个选项的值，不会对现有数据产生影响。

