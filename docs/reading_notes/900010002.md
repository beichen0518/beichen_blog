
# MongoDB权威指南 -- 读书笔记


## 第二章

- mongod 在没有参数的情况下会使用默认数据目录 /data/db（Windows 系统中为 C:\
data\db）。如果数据目录不存在或者不可写，服务器会启动失败。因此，在启动
MongoDB 前，先创建数据目录（如 mkdir -p /data/db/），以确保对该目录有写权限，
这点非常重要。
- mongod 还会启动一个非常基本的 HTTP 服务器，监听数字比主端口号高 1000 的端
口，也就是 28017 端口。这意味着，通过浏览器访问 http://localhost:28017，能获取
数据库的管理信息。
- 文档中的数组有个奇妙的特性，就是 MongoDB 能“理解”其结构，并知道如何
“深入”数组内部对其内容进行操作。这样就能使用数组内容对数组进行查询和构建
索引了。例如，之前的例子中，MongoDB 可以查询出 "things" 数组中包含 3.14
这个元素的所有文档。
- 同数组一样，MongoDB 能够“理解”内嵌文档的结构，并能“深入”其中构建索
引、执行查询或者更新

- 在脚本中可以访问 db 变量，以及其他全局变量。然而，shell 辅助函数（比如 "use 
db" 和 "show collections"）不可以在文件中使用。这些辅助函数都有对应的
JavaScript 函数，




## 第三章 

### 修改器速度

- 在mongodb中进行修改操作的时候，如果只是进行数值的修改，例如用$inc,这种速度是非常快的，而使用数组修改器可能会改变文档大小，这样可能会导致文档位置发生变化，也就是说原来的位置已经容不下它了，比如如果依次插入的文档在磁盘上是相邻的，如果其中一个文档变大了，原来的位置就放不下它了，这个文档就会被移动到集合的另一个位置。

- 移动文档是非常慢的，MongoDB必须将文档原先所占的空间释放掉，然后将文档写入另一片空间。
- 通过实验表明如果一个是进行数值修改每秒可以达到13000次，而通过$push向文档插入数据，每秒小于1500次

- 如果你的模式在进行插入和删除时会进行大量的移动或者经常打乱数据，可以使用usePowerOf2Sizes选项以提高磁盘复用率，可以通过collMod命令来设定这个选项

```python

"""
> db.runCommand({"collMod": collectionName, "usePowerOf2Sizes": true})
"""
```
- 这个集合之后进行的所有空间分配，得到的块大小都是2的幂。由于这个选项会导致初始空间分配不再那么高效，所以应该只在需要经常打乱数据的集合上使用，如果这个命令中指定"usePowerOf2Sizes"选项的值为false,就会关闭这种特殊分配机制。这个选项只会影响之后新分配的记录，因此，在已有的集合上运行这个命令或者是更改这个选项的值，不会对现有数据产生影响。

## 第四章

- 注意，查询优化器不会对
"$and" 进行优化，这与其他操作符不同。如果把上面的查询改成下面这样，效率
会更高：
> db.users.find({"x" : {"$lt" : 1, "$in" : [4]}}) 

- 如
果在整个索引范围内对数组使用 "$gt"/"$lt" 查询，效率是非常低的。查询条件
会与所有值进行比较，会查询每一个索引，而不仅仅是指定索引范围内的值。


- 用 skip 略过少量的文档还是不错的。但是要是数量非常多的话，skip 就会变得很
慢，因为要先找到需要被略过的数据，然后再抛弃这些数据。大多数数据库都会在
索引中保存更多的元数据，用于处理 skip，但是MongoDB目前还不支持，所以要尽
量避免略过太多的数据。通常可以利用上次的结果来计算下一次查询条件

- 

